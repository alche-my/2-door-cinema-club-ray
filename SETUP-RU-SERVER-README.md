# RU Server Setup Script - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –û–ø–∏—Å–∞–Ω–∏–µ

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π Bash —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ RU-—Å–µ—Ä–≤–µ—Ä–∞ (Entry/Bridge) —Å 3x-ui –ø–∞–Ω–µ–ª—å—é –∏ VLESS Reality –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º.

**–í–µ—Ä—Å–∏—è:** 1.0.0
**–î–∞—Ç–∞:** 2025-12-16

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ 3x-ui (—Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É—Å—Ç–∞–Ω–æ–≤–∫–∏)
- –°–æ–∑–¥–∞–Ω–∏–µ 1-3 inbound –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ outbound —Å–µ—Ä–≤–µ—Ä–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ (leastPing —Å—Ç—Ä–∞—Ç–µ–≥–∏—è)
- –°–æ–∑–¥–∞–Ω–∏–µ routing rules
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ BBR –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ TCP
- Port forwarding 3000-3100 ‚Üí 443

‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- IP –∞–¥—Ä–µ—Å–æ–≤
- –ü–æ—Ä—Ç–æ–≤
- UUID
- –î–æ–º–µ–Ω–Ω—ã—Ö –∏–º–µ–Ω

‚úÖ **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ `/var/log/ru-server-setup.log`
- –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏
- –î–µ—Ç–∞–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–∞
- Ubuntu 22.04+ –∏–ª–∏ Debian 12+
- Root –ø—Ä–∞–≤–∞
- –ú–∏–Ω–∏–º—É–º 1 GB RAM
- –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã (–æ—Ç–∫—Ä—ã—Ç—ã–µ)
- 22 (SSH)
- 443 (–∫–ª–∏–µ–Ω—Ç—ã)
- 2053 (3x-ui –ø–∞–Ω–µ–ª—å)
- 3000-3100 (port forwarding ‚Üí 443)

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫

```bash
bash setup-ru-server.sh
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
wget https://raw.githubusercontent.com/YOUR-REPO/setup-ru-server.sh
chmod +x setup-ru-server.sh
./setup-ru-server.sh
```

---

## –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å

### –®–∞–≥ 1: –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- –ü—Ä–∞–≤–∞ root
- –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (curl, jq, iptables, netstat, bc)
- –ù–∞–ª–∏—á–∏–µ 3x-ui

–ï—Å–ª–∏ 3x-ui –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, —Å–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–≥–æ.

### –®–∞–≥ 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ 3x-ui API

```
? 3x-ui –ø–∞–Ω–µ–ª—å URL (–±–µ–∑ http://) [localhost:2053]: localhost:2053
? Username 3x-ui [admin]: admin
? Password 3x-ui: ********
```

**–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É, –Ω–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `openssl` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π.

### –®–∞–≥ 3: BBR –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∏—Ç BBR (Bottleneck Bandwidth and Round-trip propagation time) –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ TCP.

### –®–∞–≥ 4: Port Forwarding

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ 3000-3100 –Ω–∞ 443 —á–µ—Ä–µ–∑ iptables.

### –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ Inbound

```
? –°–∫–æ–ª—å–∫–æ inbound —Å–æ–∑–¥–∞—Ç—å? [2]: 2

=== Inbound #1 ===
? –ü–æ—Ä—Ç [443]: 443
? –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç:
  1) tcp
  2) xhttp
? –í—ã–±–æ—Ä [1-2]: 1

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–æ–º–µ–Ω—ã –¥–ª—è SNI:
  ‚Ä¢ dl.google.com
  ‚Ä¢ www.microsoft.com
  ‚Ä¢ www.apple.com
  ‚Ä¢ cdn.yandex.net

? SNI –¥–æ–º–µ–Ω [www.microsoft.com]: www.microsoft.com
? DEST (–æ–±—ã—á–Ω–æ —Ç–æ—Ç –∂–µ —á—Ç–æ SNI:443) [www.microsoft.com:443]: www.microsoft.com:443

? uTLS fingerprint:
  1) chrome
  2) firefox
  3) safari
  4) random
? –í—ã–±–æ—Ä [1-4]: 1

‚Ñπ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è UUID –∏ –∫–ª—é—á–µ–π Reality...
‚úì Inbound #1 –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–ø–æ—Ä—Ç: 443, SNI: www.microsoft.com)
```

**–î–ª—è –∫–∞–∂–¥–æ–≥–æ inbound —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç UUID
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Reality –∫–ª—é—á–∏ (private/public)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Short ID
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ —Ñ–∞–π–ª

### –®–∞–≥ 6: –°–æ–∑–¥–∞–Ω–∏–µ Outbound

```
? –°–∫–æ–ª—å–∫–æ non-RU —Å–µ—Ä–≤–µ—Ä–æ–≤ (outbound) –¥–æ–±–∞–≤–∏—Ç—å? [3]: 3

=== Outbound #1 ===
? –ù–∞–∑–≤–∞–Ω–∏–µ (—Ç–µ–≥) outbound [exit-1]: exit-nl-1
? –í—Å—Ç–∞–≤—å—Ç–µ VLESS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –æ—Ç non-RU —Å–µ—Ä–≤–µ—Ä–∞:
–§–æ—Ä–º–∞—Ç: vless://uuid@ip:port?type=tcp&security=reality&...

vless://a1b2c3d4-e5f6-7890-abcd-ef1234567890@203.0.113.50:8443?type=tcp&security=reality&sni=www.google.com&fp=chrome&pbk=xY7kL9mN4pQ2rT5vW8zA1bC3dE6fG9hJ0kL2mN5pQ8r&sid=a1b2c3d4e5f67890

‚úì Outbound 'exit-nl-1' –Ω–∞—Å—Ç—Ä–æ–µ–Ω (203.0.113.50:8443)
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∞—Ä—Å–∏—Ç VLESS URL –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç:
- UUID
- Address –∏ Port
- Type (tcp/xhttp)
- Security (reality)
- SNI
- Fingerprint
- Public Key
- Short ID
- Spider X (–µ—Å–ª–∏ –µ—Å—Ç—å)
- Flow (–µ—Å–ª–∏ –µ—Å—Ç—å)

### –®–∞–≥ 7: –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –∏ Routing

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç:

**–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫:**
- –°—Ç—Ä–∞—Ç–µ–≥–∏—è: leastPing
- –°–µ–ª–µ–∫—Ç–æ—Ä: –≤—Å–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ outbound —Ç–µ–≥–∏
- Fallback: –ø–µ—Ä–≤—ã–π outbound

**Observatory:**
- Probe URL: `https://www.gstatic.com/generate_204`
- Probe Interval: 3 –º–∏–Ω—É—Ç—ã
- Concurrency: –≤–∫–ª—é—á–µ–Ω

**Routing Rule:**
- –ù–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤–µ—Å—å TCP/UDP —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫

---

## –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –≤ `/root/` –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã:

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∞–≤–∞ |
|------|----------|-------|
| `inbound-1-config.json` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Inbound #1 | 600 |
| `inbound-2-config.json` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Inbound #2 | 600 |
| `inbound-3-config.json` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Inbound #3 (–µ—Å–ª–∏ —Å–æ–∑–¥–∞–Ω) | 600 |
| `all-inbounds.json` | –í—Å–µ inbound –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ | 600 |
| `outbound-{tag}.json` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–∞–∂–¥–æ–≥–æ outbound | 600 |
| `all-outbounds.json` | –í—Å–µ outbound –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ | 600 |
| `outbound-tags.txt` | –°–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤ outbound | 600 |
| `balancer-config.json` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ | 600 |
| `observatory-config.json` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è observatory | 600 |
| `routing-rule.json` | –ü—Ä–∞–≤–∏–ª–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ | 600 |
| `ru-server-setup-report.txt` | **–§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç** | 600 |

**–õ–æ–≥–∏:**
- `/var/log/ru-server-setup.log` ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–π –ª–æ–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (644)

---

## –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ 3x-ui –ø–∞–Ω–µ–ª–∏

**–í–ê–ñ–ù–û:** –°–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –Ω–æ –Ω–µ –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Ç—å inbound/outbound —á–µ—Ä–µ–∑ API (–ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ 3x-ui).

### –í—ã –¥–æ–ª–∂–Ω—ã –≤—Ä—É—á–Ω—É—é:

#### 1. –°–æ–∑–¥–∞—Ç—å Inbound (–¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤)

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–Ω–µ–ª—å: `http://YOUR_SERVER_IP:2053`
2. **Inbounds** ‚Üí **Add Inbound**
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `/root/inbound-1-config.json`:

```yaml
Protocol: VLESS
Port: [–∏–∑ JSON]
Network: [tcp –∏–ª–∏ xhttp –∏–∑ JSON]
Security: reality

Reality Settings:
  Dest: [–∏–∑ JSON]
  Server Names: [SNI –∏–∑ JSON]
  Private Key: [–∏–∑ JSON]
  Short IDs: [–∏–∑ JSON]
  uTLS: [–∏–∑ JSON - chrome/firefox/safari]
  Flow: –û–°–¢–ê–í–¨–¢–ï –ü–£–°–¢–´–ú (none)

Clients:
  - Email: user1
    UUID: [–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–ª–∏ –∏–∑ inbound config]
    Flow: none
```

–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–ª—è –≤—Å–µ—Ö inbound.

#### 2. –°–æ–∑–¥–∞—Ç—å Outbound (–∫ non-RU —Å–µ—Ä–≤–µ—Ä–∞–º)

1. **Xray Settings** ‚Üí **Outbounds** ‚Üí **Add Outbound**
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `/root/outbound-exit-nl-1.json`:

```yaml
Tag: exit-nl-1
Protocol: VLESS
Address: [–∏–∑ JSON]
Port: [–∏–∑ JSON]
UUID: [–∏–∑ JSON]

Security: reality
Reality Settings:
  SNI: [–∏–∑ JSON]
  Server Name: [–∏–∑ JSON]
  Public Key: [–∏–∑ JSON]
  Short ID: [–∏–∑ JSON]
  Spider X: [–∏–∑ JSON –µ—Å–ª–∏ –µ—Å—Ç—å]
  Fingerprint: [–∏–∑ JSON]

Flow: [–∏–∑ JSON –µ—Å–ª–∏ –µ—Å—Ç—å]
```

–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–ª—è –≤—Å–µ—Ö outbound.

#### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫

1. **Xray Settings** ‚Üí **JSON Editor**
2. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é `"routing"`
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `"balancers"`:

```json
{
  "routing": {
    "balancers": [
      /* –í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /root/balancer-config.json */
    ]
  }
}
```

#### 4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Observatory

–í —Ç–æ–º –∂–µ JSON Editor, –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ –¥–æ–±–∞–≤—å—Ç–µ:

```json
{
  "observatory": {
    /* –í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /root/observatory-config.json */
  }
}
```

#### 5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Routing Rule

–í —Å–µ–∫—Ü–∏–∏ `"routing"` ‚Üí `"rules"` –¥–æ–±–∞–≤—å—Ç–µ:

```json
{
  "routing": {
    "rules": [
      /* –í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /root/routing-rule.json */
    ]
  }
}
```

#### 6. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å

- –ù–∞–∂–º–∏—Ç–µ **Save** –≤ JSON Editor
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Xray: `systemctl restart x-ui`

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ 3x-ui

```bash
systemctl status x-ui
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `active (running)`

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤

```bash
netstat -tuln | grep -E '(443|2053|3000|3100)'
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã –ø–æ—Ä—Ç—ã 443 –∏ 2053.

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
# –õ–æ–≥–∏ —Å–∫—Ä–∏–ø—Ç–∞
tail -f /var/log/ru-server-setup.log

# –õ–æ–≥–∏ 3x-ui
x-ui log
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ BBR

```bash
sysctl net.ipv4.tcp_congestion_control
```

–î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏: `net.ipv4.tcp_congestion_control = bbr`

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ port forwarding

```bash
iptables -t nat -L PREROUTING -v | grep REDIRECT
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ø–æ—Ä—Ç–æ–≤ 3000-3100 ‚Üí 443.

### 6. –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞

1. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å (Inbound ‚Üí Clients ‚Üí Add)
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥ –∏–ª–∏ QR-–∫–æ–¥
3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å —á–µ—Ä–µ–∑ v2rayN/v2rayNG
4. –û—Ç–∫—Ä–æ–π—Ç–µ `https://ifconfig.me` ‚Äî –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å IP non-RU —Å–µ—Ä–≤–µ—Ä–∞

---

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: API login failed

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–≤–µ—Ä–Ω—ã–µ credentials –∏–ª–∏ –ø–∞–Ω–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ 3x-ui –∑–∞–ø—É—â–µ–Ω: `systemctl status x-ui`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –≤ `/root/3xui-credentials.txt` (–µ—Å–ª–∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –≤ –ø–∞–Ω–µ–ª—å —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä

### –ü—Ä–æ–±–ª–µ–º–∞: UUID generation failed

**–ü—Ä–∏—á–∏–Ω–∞:** API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

**–†–µ—à–µ–Ω–∏–µ:** –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ `uuidgen` –∏–ª–∏ `/proc/sys/kernel/random/uuid`.

### –ü—Ä–æ–±–ª–µ–º–∞: Invalid VLESS URL

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç URL.

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ URL –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `vless://` –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
```
vless://UUID@IP:PORT?type=TYPE&security=SECURITY&sni=SNI&fp=FP&pbk=PBK&sid=SID
```

### –ü—Ä–æ–±–ª–µ–º–∞: Port already in use

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ—Ä—Ç —É–∂–µ –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç
netstat -tuln | grep –ü–û–†–¢

# –û—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–æ—Ä—Ç (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
fuser -k –ü–û–†–¢/tcp
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. Firewall: `ufw status` (–¥–æ–ª–∂–µ–Ω —Ä–∞–∑—Ä–µ—à–∞—Ç—å –ø–æ—Ä—Ç—ã)
2. Inbound —Å–æ–∑–¥–∞–Ω –∏ –≤–∫–ª—é—á–µ–Ω (–∑–µ–ª–µ–Ω—ã–π –≤ –ø–∞–Ω–µ–ª–∏)
3. Flow = none –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∫–ª–∏–µ–Ω—Ç–∞
4. SNI –¥–æ–º–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. Routing rule –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ (–≤–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ ‚Üí –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫)
2. –í—Å–µ outbound –∞–∫—Ç–∏–≤–Ω—ã (–∑–µ–ª–µ–Ω—ã–µ)
3. Non-RU —Å–µ—Ä–≤–µ—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã: `telnet IP_NON_RU PORT`

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

```bash
# –í—Å–µ inbound
cat /root/all-inbounds.json | jq '.'

# –í—Å–µ outbound
cat /root/all-outbounds.json | jq '.'

# –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫
cat /root/balancer-config.json | jq '.'

# –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
cat /root/ru-server-setup-report.txt
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ outbound –≤—Ä—É—á–Ω—É—é

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/root/outbound-new-server.json`
2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `/root/outbound-tags.txt` ‚Äî –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Ç–µ–≥
3. –û–±–Ω–æ–≤–∏—Ç–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –≤ –ø–∞–Ω–µ–ª–∏ (–¥–æ–±–∞–≤—å—Ç–µ —Ç–µ–≥ –≤ selector)
4. –°–æ–∑–¥–∞–π—Ç–µ outbound –≤ –ø–∞–Ω–µ–ª–∏ —Å —ç—Ç–∏–º —Ç–µ–≥–æ–º

### –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

```bash
rm -f /root/inbound-*.json
rm -f /root/outbound-*.json
rm -f /root/all-*.json
rm -f /root/*-config.json
rm -f /root/ru-server-setup-report.txt
rm -f /var/log/ru-server-setup.log
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∫—Ä–∏–ø—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ–∫—Ü–∏–∏

1. **Constants & Colors** ‚Äî –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ —Ü–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
2. **Logging Functions** ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
3. **Output Functions** ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥
4. **User Input Functions** ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤–≤–æ–¥
5. **Validation Functions** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
6. **System Check Functions** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã
7. **BBR Configuration** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ BBR
8. **Port Forwarding** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ iptables
9. **3x-ui API Functions** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å API
10. **Inbound Configuration** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ inbound
11. **Outbound Configuration** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ outbound
12. **Balancer Configuration** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞
13. **Routing Rules** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª
14. **Final Report** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞
15. **Main Function** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

```
main()
  ‚îú‚îÄ‚îÄ check_root()
  ‚îú‚îÄ‚îÄ check_os()
  ‚îú‚îÄ‚îÄ check_dependencies()
  ‚îú‚îÄ‚îÄ check_3xui()
  ‚îú‚îÄ‚îÄ xui_login()
  ‚îú‚îÄ‚îÄ setup_bbr()
  ‚îú‚îÄ‚îÄ setup_port_forwarding()
  ‚îú‚îÄ‚îÄ create_inbounds()
  ‚îÇ     ‚îú‚îÄ‚îÄ ask_input() x N
  ‚îÇ     ‚îú‚îÄ‚îÄ xui_generate_uuid()
  ‚îÇ     ‚îú‚îÄ‚îÄ xui_generate_x25519()
  ‚îÇ     ‚îî‚îÄ‚îÄ save configs
  ‚îú‚îÄ‚îÄ create_outbounds()
  ‚îÇ     ‚îú‚îÄ‚îÄ ask_input() x N
  ‚îÇ     ‚îú‚îÄ‚îÄ parse_vless_url()
  ‚îÇ     ‚îî‚îÄ‚îÄ save configs
  ‚îú‚îÄ‚îÄ create_balancer()
  ‚îú‚îÄ‚îÄ create_routing_rules()
  ‚îî‚îÄ‚îÄ generate_final_report()
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

- –í—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å –ø—Ä–∞–≤–∞–º–∏ `600` (—Ç–æ–ª—å–∫–æ root)
- –ü–∞—Ä–æ–ª–∏ –≤–≤–æ–¥—è—Ç—Å—è —Å–∫—Ä—ã—Ç–æ (—á–µ—Ä–µ–∑ `read -s`)
- API credentials –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ –¥–∏—Å–∫
- Cookies API —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

‚úÖ –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- –°–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ø–∞–Ω–µ–ª–∏ 3x-ui
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSH –∫–ª—é—á–∏
- –û—Ç–∫–ª—é—á–∏—Ç–µ –ø–∞—Ä–æ–ª—å–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é SSH
- –ó–∞–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç 2053 firewall (–¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ SSH tunnel)

‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ:
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏
- –û–±–Ω–æ–≤–ª—è–π—Ç–µ 3x-ui: `x-ui update`
- –û–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–∏—Å—Ç–µ–º—É: `apt update && apt upgrade`

---

## FAQ

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ?**
A: –î–∞. –°–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

**Q: –ù—É–∂–Ω–æ –ª–∏ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ inbound/outbound –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º?**
A: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –Ω–æ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ. –°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏?**
A: –î–∞, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `/root/balancer-config.json` –∏ –∏–∑–º–µ–Ω–∏—Ç–µ `type` –Ω–∞ `leastLoad` –∏–ª–∏ `random`.

**Q: –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–∞ –¥—Ä—É–≥–∏—Ö –û–° (CentOS, Arch)?**
A: –ù–µ—Ç, —Ç–æ–ª—å–∫–æ Ubuntu 22.04+ –∏ Debian 12+.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ inbound/outbound —á–µ—Ä–µ–∑ API?**
A: –ü–æ–∫–∞ –Ω–µ—Ç ‚Äî —ç—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 3x-ui API. –í–æ–∑–º–æ–∂–Ω–æ –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö.

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `/var/log/ru-server-setup.log`
2. –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Å–µ–∫—Ü–∏—é "–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç: `/root/ru-server-setup-report.txt`
4. –°–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

---

## –ê–≤—Ç–æ—Ä—ã

- Claude Code
- –í–µ—Ä—Å–∏—è: 1.0.0
- –î–∞—Ç–∞: 2025-12-16

---

**–£—Å–ø–µ—à–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏!** üöÄ
